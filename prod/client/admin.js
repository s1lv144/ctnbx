!function(){"use strict";window.chatboxAdmin={},chatboxAdmin.commandHandler={},chatboxAdmin.scriptHandler={},chatboxAdmin.dataHandler={},chatboxAdmin.ui={},chatboxAdmin.ui.init=[],chatboxAdmin.socketEvent={};var e=chatbox.utils,t=chatboxAdmin.socketEvent,o=chatboxAdmin.ui;chatboxAdmin.refreshIntervalID=-1,chatboxAdmin.refreshInterval=5,chatboxAdmin.token="123",chatboxAdmin.init=function(){var s;for(s=0;s<o.init.length;s++)o.init[s]();""!==e.getCookie("chatBoxAdminToken")&&(chatboxAdmin.token=e.getCookie("chatBoxAdminToken"),$("#socketchatbox-token").val(chatboxAdmin.token)),t.register(),chatboxAdmin.getUserList()}}(),function(){"use strict";function e(e,t){var o=e-t;0!==t&&(o=(new Date).getTime()-e),o/=1e3;var s=Math.round(o%60);o=Math.floor(o/60);var i=Math.round(o%60);o=Math.floor(o/60);var n=Math.round(o%24);o=Math.floor(o/24);var c=o,a="";return c&&(a+=c+" d "),n&&(a+=n+" hr "),i&&(a+=i+" min "),a+=s+" sec"}var t=chatbox.utils;t.createNewWindowLink=function(e){return"<a target = '_blank' href = '"+e+"''>"+e+"</a>"},t.getTimeElapsed=e,t.countKeys=function(e){var t=0;for(var o in e)e.hasOwnProperty(o)&&++t;return t}}(),function(e){"use strict";e.fn.drags=function(t){t=e.extend({handle:"",cursor:"move"},t);var o;return o=""===t.handle?this:this.find(t.handle),o.css("cursor",t.cursor).on("mousedown",function(o){var s;s=""===t.handle?e(this).addClass("draggable"):e(this).addClass("active-handle").parent().addClass("draggable");var i=s.css("z-index"),n=s.outerHeight(),c=s.outerWidth(),a=s.offset().top+n-o.pageY,r=s.offset().left+c-o.pageX;s.css("z-index",1e3).parents().on("mousemove",function(t){e(".draggable").offset({top:t.pageY+a-n,left:t.pageX+r-c}).on("mouseup",function(){e(this).removeClass("draggable").css("z-index",i)})}),o.preventDefault()}).on("mouseup",function(){""===t.handle?e(this).removeClass("draggable"):e(this).removeClass("active-handle").parent().removeClass("draggable")})}}(jQuery),function(){"use strict";function e(){bootbox.prompt("Send Message To Selected User/Sockets",function(e){null===e||i.sendMessage(e)})}function t(){bootbox.prompt("Redirect Users/Sockets To",function(e){null===e||i.redirect(e)})}function o(){bootbox.confirm({size:"small",message:"Are you sure?",callback:function(e){e&&i.kick()}})}var s=chatboxAdmin.ui,i=chatboxAdmin.commandHandler;s.init.push(function(){$(".socketchatbox-command-message").click(function(t){t.preventDefault(),e()}),$(".socketchatbox-command-redirect").click(function(e){e.preventDefault(),t()}),$(".socketchatbox-command-kick").click(function(e){e.preventDefault(),o()})})}(),function(){"use strict";function e(e){chatboxAdmin.refreshInterval=e,$(".socketchatbox-refresh-interval-val").text(e),o()}function t(){chatbox.socket.emit("getUserList",{token:chatboxAdmin.token}),chatboxAdmin.refreshIntervalID=setTimeout(function(){t()},1e3*chatboxAdmin.refreshInterval)}function o(){clearTimeout(chatboxAdmin.refreshIntervalID),chatboxAdmin.getUserList()}var s=chatboxAdmin.ui;s.init.push(function(){$(".socketchatbox-refresh-interval").change(function(){e(this.value)})}),chatboxAdmin.getUserList=t,chatboxAdmin.restartGetUserList=o}(),function(){"use strict";var e=chatboxAdmin.scriptHandler,t=chatboxAdmin.ui;t.init.push(function(){var t=$(".socketchatbox-admin-input textarea");$(".prevScript").click(function(){e.prevScript()&&$(".socketchatbox-scriptHistoryScript").html(e.getScript())}),$(".nextScript").click(function(){e.nextScript()&&$(".socketchatbox-scriptHistoryScript").html(e.getScript())}),$(".cloneScript").click(function(){t.val(e.getScript())}),$("#sendScript").click(function(){var o=t.val();if(e.canSend()){t.val(""),e.sendScript(o),$(".socketchatbox-scriptHistoryScript").html(e.getScript());var s="Script is sent.";$("#socketchatbox-scriptSentStatus").text(s),$("#socketchatbox-scriptSentStatus").removeClass("redFont")}else $("#socketchatbox-scriptSentStatus").text("Must select at least one user to send script to."),$("#socketchatbox-scriptSentStatus").addClass("redFont")})})}(),function(){"use strict";function e(){$("#socketchatbox-online-users").html("Invalid Token!"),s.html("Invalid Token!"),s.addClass("error"),s.removeClass("green")}function t(){s.html("Valid Token"),s.removeClass("error"),s.addClass("green")}function o(e){chatboxAdmin.verified=!1,chatboxAdmin.token=e,i.addCookie("chatBoxAdminToken",e),chatboxAdmin.restartGetUserList()}var s,i=chatbox.utils,n=chatboxAdmin.ui;n.init.push(function(){s=$("#socketchatbox-tokenStatus"),$("#socketchatbox-updateToken").click(function(){o($("#socketchatbox-token").val())}),$(window).keydown(function(e){return 13===e.which&&$("#socketchatbox-token").is(":focus")?void o($("#socketchatbox-token").val()):void 0})}),n.badToken=e,n.validToken=t}(),function(){"use strict";function e(){s.showHistory?($(".socketchatbox-actionhistory-togglecollapse").fadeIn().css("display","inline-block"),s.$actionHistoryDiv.slideDown(function(){$(".socketchatbox-actionhistory-arrow").text(" ↑ ")})):s.$actionHistoryDiv.slideUp(function(){$(".socketchatbox-actionhistory-arrow").text(" ↓ "),$(".socketchatbox-actionhistory-togglecollapse").fadeOut()})}function t(t){var c=0;if(t.id!==i)s.$actionHistoryDiv.html(""),s.showHistory=!1,e();else{if(t.actionList.length===n)return;c=n}for(i=t.id,n=t.actionList.length,$(".socketchatbox-actionhistory-count").text(n);n>c;c++){var a=t.actionList[c],r=$("<div></div>"),d=new Date(Number(a.time)),l=i+c,u=$("<div></div>"),h=("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2)+":"+("0"+d.getSeconds()).slice(-2);h+="<span class = 'socketchatbox-actionhistory-actiontype breakable'>"+a.type+"</span>",u.html(h),u.addClass("socketchatbox-actionhistory-basic"),u.data("targetDetail",l),r.append(u);var k=$("<div></div>");k.addClass("socketchatbox-actionhistory-actiondetail");var m=$("<div></div>");m.addClass(l),m.addClass("collapse"),m.html("At: "+o.createNewWindowLink(a.url)+"<br/>"+a.detail),k.append(m),r.append(k),r.addClass("socketchatbox-userdetail-actions-each"),s.$actionHistoryDiv.append(r)}}var o=chatbox.utils,s=(chatboxAdmin.scriptHandler,chatboxAdmin.dataHandler,chatboxAdmin.ui);s.showHistory=!1;var i="-1",n=0;s.init.push(function(){s.$actionHistoryDiv=$(".socketchatbox-userdetail-actions"),s.$actionHistoryDiv.on("click",".socketchatbox-actionhistory-basic",function(){var e=$(this).data("targetDetail");$("."+e).slideToggle()}),$(".socketchatbox-actionhistory-header").click(function(){s.showHistory?s.showHistory=!1:s.showHistory=!0,e()}),e(),$(".socketchatbox-actionhistory-expandAll").click(function(){$(".socketchatbox-actionhistory-actiondetail .collapse").slideDown()}),$(".socketchatbox-actionhistory-collapseAll").click(function(){$(".socketchatbox-actionhistory-actiondetail .collapse").slideUp()})}),s.loadUserActionHistory=t}(),function(){"use strict";function e(){for(var e in s.getUserDict()){var t=s.getUserDict()[e],i=t.username;t.count>1&&(i+=" <span class='badge'>"+t.count+"<span>");var n=$("<button></button>");n.html(i),n.prop("title","Join Time: "+o.getTimeElapsed(t.joinTime)),n.addClass("username-info"),n.addClass("btn"),n.addClass("btn-default"),n.data("id",t.id);var c=$("<button></button>");t.id===s.getOpenedUserID()?(c.text(" ↑ "),c.prop("title","Close User Detail"),c.addClass("yellow"),t.arrowSpan=c):(c.text(" ↓ "),c.prop("title","Open User Detail")),c.addClass("username-info-viewmore"),c.addClass("btn"),c.addClass("btn-default"),c.data("id",t.id),t.jqueryObj=n;var a=$("<div></div>");a.addClass("btn-group"),a.addClass("socketchatbox-onlineuserlist-user"),a.append(n),a.append(c),$("#socketchatbox-online-users").append(a)}}function t(){for(var e in s.getUserDict()){var t=s.getUserDict()[e];s.userFullySelected(e)?(t.jqueryObj.removeClass("partially-selected"),t.jqueryObj.addClass("selected")):s.userPartiallySelected(e)?(t.jqueryObj.removeClass("selected"),t.jqueryObj.addClass("partially-selected")):(t.jqueryObj.removeClass("selected"),t.jqueryObj.removeClass("partially-selected"))}}var o=chatbox.utils,s=chatboxAdmin.dataHandler,i=chatboxAdmin.ui;i.init.push(function(){$("#selectAll").click(function(){s.selectAllUsers(),i.resetAllUsersHighlight(),""!==s.getOpenedUserID()&&i.resetOpenUserSocketHighlight(s.getOpenedUserID())}),$("#selectNone").click(function(){s.selectNoSocketNorUser(),t(),""!==s.getOpenedUserID()&&i.resetOpenUserSocketHighlight(s.getOpenedUserID())})}),$(document).on("click",".username-info",function(){var e=$(this),o=e.data("id");s.toggleUserSelection(o),t(),s.getOpenedUserID()===o&&i.resetOpenUserSocketHighlight(o)}),i.renderOnlineUsers=e,i.resetAllUsersHighlight=t}(),function(){"use strict";function e(e){var t=$(".socketchatbox-userdetail-name-edit").val(),o={};o.token=chatboxAdmin.token,o.userID=e,o.newName=t,chatbox.socket.emit("admin change username",o),chatboxAdmin.restartGetUserList()}function t(e){o(e),c.loadSocketDetail(e),c.loadUserActionHistory(e)}function o(e){$(".socketchatbox-userdetail-name").text(e.username),$(".socketchatbox-userdetail-name-edit").data("name")!==e.username&&($(".socketchatbox-userdetail-name-edit").val(e.username),$(".socketchatbox-userdetail-name-edit").data("name",e.username)),$(".socketchatbox-admin-changeUserName").data("id",e.id),$(".socketchatbox-userdetail-landingpage").html()!==i.createNewWindowLink(e.url)&&$(".socketchatbox-userdetail-landingpage").html(i.createNewWindowLink(e.url)),e.referrer?$(".socketchatbox-userdetail-referrer").html(i.createNewWindowLink(e.referrer)):$(".socketchatbox-userdetail-referrer").text("N/A"),$(".socketchatbox-userdetail-ip").text()!==e.ip&&$(".socketchatbox-userdetail-ip").text(e.ip),$(".socketchatbox-userdetail-jointime").text(i.getTimeElapsed(e.joinTime)),$(".socketchatbox-userdetail-totalmsg").text()!==e.msgCount&&$(".socketchatbox-userdetail-totalmsg").text(e.msgCount),e.lastMsg||(e.lastMsg="N/A"),$(".socketchatbox-userdetail-lastmsg").text()!==e.lastMsg&&$(".socketchatbox-userdetail-lastmsg").text(e.lastMsg),$(".socketchatbox-userdetail-lastactive").text()!==i.getTimeElapsed(e.lastActive)&&$(".socketchatbox-userdetail-lastactive").text(i.getTimeElapsed(e.lastActive)),$(".socketchatbox-userdetail-useragent").text()!==e.userAgent&&$(".socketchatbox-userdetail-useragent").text(e.userAgent),$(".socketchatbox-userdetail-room").text()!==e.roomID&&$(".socketchatbox-userdetail-room").text(e.roomID)}function s(){var e=n.getOpenedUserID();e in n.getUserDict()?(t(n.getUserDict()[e]),c.resetOpenUserSocketHighlight(e)):n.setOpenedUserID("")}var i=chatbox.utils,n=chatboxAdmin.dataHandler,c=chatboxAdmin.ui;c.init.push(function(){$(".socketchatbox-admin-lookupIP").click(function(){window.open("https://geoiptool.com/en/?ip=")}),$(window).keydown(function(t){if(13===t.which&&$(".socketchatbox-userdetail-name-edit").is(":focus")){var o=$(".socketchatbox-admin-changeUserName").data("id");return void e(o)}})}),$(document).on("click",".username-info-viewmore",function(){var e=$(this),o=e.data("id"),s=n.getUserDict()[o];if(n.getOpenedUserID()===o)$(".socketchatbox-admin-userdetail-pop").slideUp(),e.text(" ↓ "),e.removeClass("yellow"),n.setOpenedUserID("");else{var i=n.getOpenedUserID();if(i in n.getUserDict()){var a=n.getUserDict()[i];a.arrowSpan.text(" ↓ "),a.arrowSpan.removeClass("yellow")}e.text(" ↑ "),e.addClass("yellow"),n.setOpenedUserID(o),s.arrowSpan=e,t(s),$(".socketchatbox-admin-userdetail-pop").is(":visible")||$(".socketchatbox-admin-userdetail-pop").slideDown(),c.resetOpenUserSocketHighlight(o)}}),$(document).on("click",".socketchatbox-admin-changeUserName",function(){var t=$(this),o=t.data("id");e(o)}),c.renderOpenedUserDetail=s}(),function(){"use strict";function e(){n.showAliveSocket?$(".socketchatbox-userdetail-sockets").slideDown(function(){$(".socketchatbox-livesockets-arrow").text(" ↑ ")}):$(".socketchatbox-userdetail-sockets").slideUp(function(){$(".socketchatbox-livesockets-arrow").text(" ↓ ")})}function t(t){t.id!=c&&(c=t.id,n.showAliveSocket&&(n.showAliveSocket=!1,e())),$(".socketchatbox-userdetail-sockets").html(""),$(".socketchatbox-livesockets-count").text(t.socketList.length);for(var o=0;o<t.socketList.length;o++){var i=t.socketList[o],a=$("<div></div>"),r="<center>["+o+"]</center>";a.html(r);var d=$("<div></div>"),l="<table class='table table-bordered'><tbody>";l+="<tr><td>ID</td><td class='breakable'>"+i.id+"</td></tr>",l+="<tr><td>URL</td><td class='breakable'>"+s.createNewWindowLink(i.url)+"</td></tr>",i.referrer&&(l+="<tr><td>Referrer</td><td class='breakable'>"+s.createNewWindowLink(i.referrer)+"</td></tr>"),l+="<tr><td>IP</td><td>"+i.ip+"</td></tr>",l+="<tr><td>Total Messages</td><td>"+i.msgCount+"</td></tr>",i.lastMsg&&(l+="<tr><td>Last Message</td><td class='breakable'>\""+i.lastMsg+'"</td></tr>'),l+="<tr><td>Idle Time</td><td>"+s.getTimeElapsed(i.lastActive)+"</td></tr>",l+="<tr><td>Connection Time</td><td>"+s.getTimeElapsed(i.joinTime)+"</td></tr>",l+="</tbody></table>",d.html(l),a.addClass("socketchatbox-socketdetail-each"),a.data("id",i.id),i.jqueryObj=a,$(".socketchatbox-userdetail-sockets").append(a),$(".socketchatbox-userdetail-sockets").append(d)}}function o(e){for(var t=i.getUserDict()[e],o=0;o<t.socketList.length;o++){var s=t.socketList[o];i.userFullySelected(t.id)||i.socketSelected(s.id)?s.jqueryObj.addClass("selectedSocket"):s.jqueryObj.removeClass("selectedSocket")}}var s=chatbox.utils,i=chatboxAdmin.dataHandler,n=chatboxAdmin.ui,c="-1";n.showAliveSocket=!1,n.init.push(function(){$(".socketchatbox-livesockets-header").click(function(){n.showAliveSocket?n.showAliveSocket=!1:n.showAliveSocket=!0,e()}),e()}),$(document).on("click",".socketchatbox-socketdetail-each",function(){var e=$(this),t=e.data("id"),o=i.getSocketDict()[t],s=o.user;i.toggleSocketSelection(t),n.resetAllUsersHighlight(),n.resetOpenUserSocketHighlight(s.id)}),n.loadSocketDetail=t,n.resetOpenUserSocketHighlight=o}(),function(){"use strict";function e(e,o){var s={};s.token=chatboxAdmin.token,s.content=o,s.userKeyList=t.getSelectedUserList(),s.socketKeyList=t.getSelectedSocketList(),s.type="admin "+e,chatbox.socket.emit("admin command",s)}var t=chatboxAdmin.dataHandler,o=chatboxAdmin.commandHandler;o.canSend=function(){var e=t.selectedUsersCount(),o=t.selectedSocketsCount();return e+o>0},o.sendMessage=function(t){e("message",t)},o.redirect=function(t){e("redirect",t)},o.kick=function(){e("kick")}}(),function(){"use strict";function e(e){var t=h[e];delete m[e],delete x[e],t.selectedSocketCount=0;for(var o=0;o<t.socketList.length;o++){var s=t.socketList[o];s.selected=!1,delete b[s.id]}}function t(e){var t=h[e];m[e]=t,delete x[e],t.selectedSocketCount=t.count;for(var o=0;o<t.socketList.length;o++){var s=t.socketList[o];s.selected=!0,delete b[s.id]}}function o(o){o in m?e(o):(e(o),t(o))}function s(e){var t=k[e],o=t.user;t.selected?(t.selected=!1,o.selectedSocketCount--):(t.selected=!0,o.selectedSocketCount++),i(o)}function i(o){o.selectedSocketCount===o.count?(e(o.id),t(o.id)):o.selectedSocketCount>0?(x[o.id]=o,a(o),delete m[o.id]):e(o.id)}function n(){m={},b={},x={};for(var t in h){var o=h[t];e(o.id)}}function c(){for(var e in h){var o=h[e];t(o.id)}}function a(e){for(var t=0;t<e.socketList.length;t++){var o=e.socketList[t];o.selected?b[o.id]=o:delete b[o.id]}}function r(){var e;for(e in m)e in h?t(e):delete m[e];for(e in x)if(e in h){for(var o=h[e],s=0;s<o.socketList.length;s++){var n=o.socketList[s];n.id in b&&(n.selected=!0,o.selectedSocketCount++)}i(o)}else delete x[e];for(var c in b)c in k||delete b[c]}function d(e){h=e,k={};for(var t in h){var o=h[t];o.selectedSocketCount=0,o.count=o.socketIDList.length;for(var s=0;s<o.socketList.length;s++){var i=o.socketList[s];i.user=o,i.selected=!1,k[i.id]=i}}r()}var l=chatbox.utils,u=chatboxAdmin.dataHandler,h={},k={},m={},b={},x={},p="default";u.getUserDict=function(){return h},u.getSocketDict=function(){return k},u.getOpenedUserID=function(){return p},u.setOpenedUserID=function(e){p=e},u.userFullySelected=function(e){return e in m},u.userPartiallySelected=function(e){return e in x},u.socketSelected=function(e){return e in b},u.selectedUsersCount=function(){return l.countKeys(m)},u.selectedSocketsCount=function(){return l.countKeys(b)},u.getSelectedUsers=function(){return m},u.getSelectedSockets=function(){return b},u.getSelectedUserList=function(){var e=[];for(var t in u.getSelectedUsers())e.push(t);return e},u.getSelectedSocketList=function(){var e=[];for(var t in u.getSelectedSockets())e.push(t);return e},u.toggleUserSelection=o,u.toggleSocketSelection=s,u.selectNoSocketNorUser=n,u.selectAllUsers=c,u.loadUserSocketFromServer=d}(),function(){"use strict";function e(e){var s={};s.token=chatboxAdmin.token,s.content=e,s.userKeyList=o.getSelectedUserList(),s.socketKeyList=o.getSelectedSocketList(),s.type="admin script",chatbox.socket.emit("admin command",s),t(e)}function t(e){i.push(e),n=i.length-1}var o=chatboxAdmin.dataHandler,s=chatboxAdmin.scriptHandler;s.canSend=function(){var e=o.selectedUsersCount(),t=o.selectedSocketsCount();return e+t>0},s.sendScript=e;var i=[],n=-1;s.pushScript=t,s.getScript=function(){return n>=0&&n<i.length?i[n]:""},s.nextScript=function(){return n<i.length-1?(n++,!0):!1},s.prevScript=function(){return n>0?(n--,!0):!1}}(),function(){"use strict";var e=chatboxAdmin.ui,t=chatboxAdmin.dataHandler;chatboxAdmin.verified=!1;var o=chatboxAdmin.socketEvent;o.register=function(){var o=chatbox.socket;o.on("server stat",function(e){var t=$("<p></p>");t.html("<p>Welcome, Admin! </p><p>The Chatbox was started on "+e.chatboxUpTime+".</p><p>There have been "+e.totalUsers+" users, "+e.totalSockets+" sockets and "+e.totalMsg+" messages.</p>"),t.addClass("server-log-message"),$(".socketchatbox-admin-server").append(t),$(".socketchatbox-admin-server")[0].scrollTop=$(".socketchatbox-admin-server")[0].scrollHeight}),o.on("room stat",function(e){var t=$("<p></p>");t.html("<p>Welcome, Room Admin! </p><p>The Room was opened on "+e.createTime+".</p><p>There have been "+e.totalUsers+" users, "+e.totalSockets+" sockets and "+e.totalMsg+" messages.</p>"),t.addClass("server-log-message"),$(".socketchatbox-admin-server").append(t),$(".socketchatbox-admin-server")[0].scrollTop=$(".socketchatbox-admin-server")[0].scrollHeight}),o.on("server log",function(e){var t=$("<p></p>"),o=new Date,s=$("<span></span");s.addClass("log-time");var i=("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2);s.text(i),t.append(s),t.append(e.log),t.addClass("server-log-message"),$(".socketchatbox-admin-server").append(t),$(".socketchatbox-admin-server")[0].scrollTop=$(".socketchatbox-admin-server")[0].scrollHeight}),o.on("listUsers",function(s){$("#socketchatbox-online-users").html(""),s.success?(e.validToken(),chatboxAdmin.verified||(chatboxAdmin.verified=!0,o.emit("getServerStat",{token:chatboxAdmin.token})),t.loadUserSocketFromServer(s.userdict),e.renderOnlineUsers(),e.resetAllUsersHighlight(),e.renderOpenedUserDetail()):($("#socketchatbox-online-users").html("Invalid Token!"),e.badToken())})}}(),function(){"use strict";function e(){setTimeout(function(){t()?chatboxAdmin.init():setTimeout(function(){e()},1e3)},1e3)}function t(){return"undefined"!=typeof chatbox&&"undefined"!=typeof chatbox.socket&&chatbox.socket.joined}t()?chatboxAdmin.init():e()}();